{% extends "layout.html" %}
{% block title %}{{ _('Ø³ÙŠØ§Ø±Ø§ØªÙŠ') }}{% endblock %}
{% import 'components/vehicle_card.html' as vc %}
{% block content %}

<div class="max-w-7xl mx-auto py-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="font-heading text-2xl text-neutral">ğŸš— {{ _('Ø³ÙŠØ§Ø±Ø§ØªÙŠ') }}</h1>
    <a href="{{ url_for('cust.track') }}" class="px-4 py-2 rounded-md bg-accent text-neutral font-medium cta-pulse">{{ _('ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ù€ VIN') }}</a>
  </div>

  {% if cars %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for v in cars %}
        <div class="space-y-3">
          {{ vc.vehicle_card(v, loop.index0, 'cust_details', true) }}
          <div class="bg-white border border-slate-200 rounded-xl p-4">
            <form method="post" action="{{ url_for('cust.request_sale_listing', vehicle_id=v.id) }}" class="flex items-center gap-3">
              <label class="text-sm text-muted">{{ _('Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„Ø¨ÙŠØ¹ (OMR)') }}</label>
              <input name="asking_price_omr" type="number" step="0.001" min="0" required class="border rounded px-3 py-1.5 text-sm w-40" placeholder="{{ _('Ø§Ù„Ù…Ø¨Ù„Øº') }}">
              <button type="submit" class="px-3 py-1.5 rounded-md bg-primary text-white text-sm font-medium hover:shadow">{{ _('Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ¸Ù') }}</button>
              {% set listing = (sale_listings.get(v.id) if sale_listings else None) %}
              {% if listing %}
                <span class="text-xs px-2 py-1 rounded {{ 'bg-yellow-100 text-yellow-800' if listing.status=='Pending' else ('bg-green-100 text-green-800' if listing.status=='Approved' else 'bg-red-100 text-red-800') }}">
                  {{ _('Ø§Ù„Ø­Ø§Ù„Ø©') }}: {{ listing.status }} â€” {{ _('Ø§Ù„Ø³Ø¹Ø±') }}: {{ '%.3f'|format(listing.asking_price_omr) }} OMR
                </span>
              {% endif %}
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="bg-white border border-slate-200 rounded-2xl p-8 text-center text-muted">
      {{ _('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙƒØ¨Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø­Ø³Ø§Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹.') }}
    </div>
  {% endif %}
</div>
{% endblock %}
