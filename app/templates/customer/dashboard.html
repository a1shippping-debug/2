{% extends "layout.html" %}
{% block title %}لوحة العميل{% endblock %}
{% block content %}

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

  body {
    font-family: 'Cairo', sans-serif;
    background: linear-gradient(135deg, #f8fafc 0%, #eaf0ff 100%);
  }

  .dashboard-header {
    background: #1E2BA0;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 2rem;
    border-radius: 0.75rem;
    margin-bottom: 2rem;
  }

  .dashboard-header img {
    height: 50px;
  }

  .car-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(15px);
    animation: fadeInUp 0.6s ease forwards;
  }

  .car-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .stage-dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 9999px;
  }

  .search-bar {
    background: white;
    padding: 1rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
</style>

<div class="min-h-screen relative overflow-hidden">
  <!-- خلفية الشعار الشفافة -->
  <div class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">
    <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="Logo" class="max-w-[600px]">
  </div>

  <!-- رأس الصفحة -->
  <div class="dashboard-header">
    <div class="flex items-center gap-3">
      <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="Logo">
      <h1 class="text-2xl font-bold">لوحة العميل</h1>
    </div>
    <a href="{{ url_for('cust.invoices_list') }}"
       class="px-4 py-2 bg-white text-[#1E2BA0] rounded-xl font-semibold hover:bg-slate-100">
      فواتيري
    </a>
  </div>

  <!-- شريط البحث -->
  <form method="get" class="mb-8">
    <div class="search-bar flex gap-2 items-center">
      <input name="q" value="{{ q or '' }}" placeholder="ابحث برقم اللوت أو رقم الشاصي"
             class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-400" />
      <button class="px-4 py-2 bg-[#1E2BA0] text-white rounded hover:bg-blue-800 transition">
        بحث
      </button>
    </div>
    <p class="text-gray-500 text-sm mt-2">أدخل رقم اللوت أو رقم الشاصي (VIN)</p>
  </form>

  {% if results is defined %}
    {% if results %}
      <h2 class="text-xl font-semibold mb-4 text-[#1E2BA0]">سياراتي</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for r in results %}
          {% set v = r.vehicle %}
          {% set a = r.auction %}
          {% set s = r.stages %}
          <div class="car-card">
            <div class="flex justify-between items-center mb-3">
              <div>
                <div class="font-semibold text-lg text-slate-800">{{ v.make }} {{ v.model }} {{ v.year }}</div>
                <div class="text-sm text-gray-500">
                  VIN: {{ v.vin }}{% if a and a.lot_number %} • Lot: {{ a.lot_number }}{% endif %}
                </div>
              </div>
              <div class="text-sm text-gray-700">الحالة: <span class="font-semibold text-[#1E2BA0]">{{ v.status or '-' }}</span></div>
            </div>

            <div class="space-y-2 mt-2">
              <div class="flex items-center gap-2">
                <span class="stage-dot {{ 'bg-green-500' if s.paid else 'bg-gray-300' }}"></span>
                <span class="text-sm">دفع السيارة من المزاد</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="stage-dot {{ 'bg-green-500' if s.picked_up else 'bg-gray-300' }}"></span>
                <span class="text-sm">سحب السيارة من المزاد</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="stage-dot {{ 'bg-green-500' if s.warehouse else 'bg-gray-300' }}"></span>
                <span class="text-sm">وصول السيارة للمستودع</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="stage-dot {{ 'bg-green-500' if s.shipped else 'bg-gray-300' }}"></span>
                <span class="text-sm">شحن السيارة</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="stage-dot {{ 'bg-green-500' if s.delivered else 'bg-gray-300' }}"></span>
                <span class="text-sm">وصول السيارة</span>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="p-4 bg-white border border-slate-200 rounded-xl text-center shadow">
        <p class="text-slate-600">لا توجد مركبات مرتبطة بحسابك حالياً.</p>
        <p class="text-sm text-slate-400 mt-1">
          عند إضافة مركبات إلى حسابك ستظهر هنا في قسم "سياراتي".
        </p>
      </div>
    {% endif %}
  {% endif %}
</div>

{% endblock %}
