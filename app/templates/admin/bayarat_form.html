{% extends "base_admin.html" %}
{% block title %}{{ auction and _('Edit Auction') or _('New Auction') }}{% endblock %}
{% block header %}{{ auction and _('Edit Auction') or _('New Auction') }}{% endblock %}
{% block content %}
<form method="post" class="bg-white border border-gray-200 rounded-2xl p-6 max-w-3xl">
  {# For new auction: limit fields to Master Buyer, Buyer Number, Client #}
  {% if not auction %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm text-gray-700">{{ _('Master Buyer') }}</label>
      <input name="buyer_name" list="buyers_list" value="{{ form.buyer_name or '' }}" class="w-full border border-gray-300 rounded p-2" placeholder="{{ _('Type or select buyer') }}">
      <datalist id="buyers_list">
        {% for b in (buyers or []) %}
        <option value="{{ b.name }}"></option>
        {% endfor %}
      </datalist>
      <p class="text-xs text-gray-500 mt-1">{{ _('New name will create a new buyer') }}</p>
    </div>
    <div>
      <label class="block text-sm text-gray-700">{{ _('Buyer Number') }}</label>
      <input name="lot_number" value="{{ form.lot_number or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div>
      <label class="block text-sm text-gray-700">{{ _('Client') }}</label>
      <select name="customer_id" class="w-full border border-gray-300 rounded p-2">
        <option value="">-</option>
        {% for c in (customers or []) %}
        <option value="{{ c.id }}" {% if (form.customer_id or '')|string == (c.id|string) %}selected{% endif %}>{{ c.company_name or c.full_name }}</option>
        {% endfor %}
      </select>
    </div>
  </div>
  {% else %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm text-gray-700">{{ _('Provider') }}</label>
      <input name="provider" value="{{ form.provider or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div>
      <label class="block text-sm text-gray-700">{{ _('Lot Number') }}</label>
      <input name="lot_number" value="{{ form.lot_number or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div>
      <label class="block text-sm text-gray-700">{{ _('Date') }}</label>
      <input type="date" name="auction_date" value="{{ form.auction_date or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div>
      <label class="block text-sm text-gray-700">{{ _('Location') }}</label>
      <input name="location" value="{{ form.location or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div class="md:col-span-2">
      <label class="block text-sm text-gray-700">{{ _('URL') }}</label>
      <input type="url" name="auction_url" value="{{ form.auction_url or '' }}" class="w-full border border-gray-300 rounded p-2">
    </div>
    <div class="md:col-span-2">
      <label class="block text-sm text-gray-700">{{ _('Notes') }}</label>
      <textarea name="notes" rows="4" class="w-full border border-gray-300 rounded p-2">{{ form.notes or '' }}</textarea>
    </div>

    <div>
      <label class="block text-sm text-gray-700">{{ _('Buyer') }}</label>
      <input name="buyer_name" list="buyers_list" value="{{ form.buyer_name or '' }}" class="w-full border border-gray-300 rounded p-2" placeholder="{{ _('Type or select buyer') }}">
      <datalist id="buyers_list">
        {% for b in (buyers or []) %}
        <option value="{{ b.name }}"></option>
        {% endfor %}
      </datalist>
      <p class="text-xs text-gray-500 mt-1">{{ _('New name will create a new buyer') }}</p>
    </div>

    <div>
      <label class="block text-sm text-gray-700">{{ _('Client') }}</label>
      <select name="customer_id" class="w-full border border-gray-300 rounded p-2">
        <option value="">-</option>
        {% for c in (customers or []) %}
        <option value="{{ c.id }}" {% if (form.customer_id or '')|string == (c.id|string) %}selected{% endif %}>{{ c.company_name or c.full_name }}</option>
        {% endfor %}
      </select>
    </div>
  </div>
  {% endif %}

  <div class="mt-6 flex items-center gap-3">
    <button class="px-4 py-2 bg-primary text-white rounded" type="submit">{{ auction and _('Save') or _('Create') }}</button>
    <a href="{{ url_for('admin.bayarat_list') }}" class="text-gray-700">{{ _('Cancel') }}</a>
  </div>
</form>
<script>
(function() {
  // Optional enhancement: prefill lot_number into car form when creating cars later
})();
</script>
{% endblock %}
